name: Keep Supabase Alive

on:
  schedule:
    # Run at 00:00 UTC every Monday (weekly is usually enough, but Mon/Thu ensures <7 days gap)
    - cron: '0 0 * * 1,4'
  workflow_dispatch: # Allow manual trigger

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Supabase
        env:
          # Use secrets for best security, but defaults to public key if secret not set
          SUPABASE_URL: ${{ secrets.PUBLIC_SUPABASE_URL || 'https://cusemqzwingcxipbcobe.supabase.co' }}
          SUPABASE_KEY: ${{ secrets.PUBLIC_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1c2VtcXp3aW5nY3hpcGJjb2JlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwODI0MDYsImV4cCI6MjA3ODY1ODQwNn0.VXO0_JDc34tcvJwBZsLGZS9vn6nqFHA6U_GGqoOOXys' }}
        run: |
          echo "Pinging Supabase API to prevent pausing..."
          curl -s -X GET "$SUPABASE_URL/rest/v1/news_posts?select=id&limit=1" \
            -H "apikey: $SUPABASE_KEY" \
            -H "Authorization: Bearer $SUPABASE_KEY"
